---
- hosts: test-kitchen

  vars:
    java_package_by_os_family:
      debian: 'openjdk-8-jdk'
      redhat: 'java-1.8.0-openjdk'
    java_package: "{{ java_package_by_os_family[ansible_os_family|lower] }}"
    logstash_version_by_os_family:
      debian: '1:2.2.4-1'
      redhat: '2.4.0'
    logstash_version: "{{ logstash_version_by_os_family[ansible_os_family|lower] }}"
    logstash_heap_size: "256m"
    logstash_input_configs:
      - |
        file {
                path => ["/var/log/boot.log"]
           }
      - |
        beats {
                port => 5044
           }
    logstash_output_configs:
      - |
        stdout {
                codec => rubydebug
            }
      - |
        elasticsearch {
                hosts => "localhost:9200"
                manage_template => false
                index => "%{[@metadata][beat]}-%{+YYYY.MM.dd}"
                document_type => "%{[@metadata][type]}"
            }

  roles:
    - wunzeco.java
    - ansible-logstash
